<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src='main.js'></script> -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      const url = "http://localhost:5000/co2/Raum2";
      google.charts.load('current', {'packages':['annotationchart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var request = new XMLHttpRequest();
        request.open('GET', url, true);

        request.onload = function() {
        if (request.status >= 200 && request.status < 400) {

          var jsonData = JSON.parse(request.responseText);
          var dataArray = convertToNumber(CSVToArray(jsonData['csv']));
          console.log(dataArray)
          var data = google.visualization.arrayToDataTable(dataArray);

          var options = {
            title: 'CO2 Gehalt',
            displayAnnotations: true
            
          };

          var chart = new google.visualization.AnnotationChart(document.getElementById('curve_chart'));

          chart.draw(data, options);

        } else {
          console.log("Fetching Data failed." + request.status);
        }
        };

        request.onerror = function() {
        // There was a connection error of some sort
        };

        request.send();


      }
    </script>

</head>
<body>
    <div id="curve_chart" style="width: 900px; height: 500px">
    
    <script>

    

    var CSVToArray = function CSVToArray(data) {
        var delimiter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ",";
        var omitFirstRow = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
        
        return data
            .slice(omitFirstRow ? data.indexOf("\n") + 1 : 0)
            .split("\n")
            .map(function(v) {
                return v.split(delimiter);
            });
    };

    function convertToNumber(array){
      for (i = 1; i < array.length; i++){
        array[i][1] = parseInt(array[i][1]);
        array[i][0] = new Date(array[i][0]);
      }
      return array;
    }

    

    </script>
</body>
</html>